#!/bin/sh

pfsDesignId=$1
if [ -z "$pfsDesignId" ]; then
    echo "Missing pfsDesignId value"
    exit 1
fi
pfsDesignId2=$2
if [ -z "$pfsDesignId2" ]; then
    pfsDesignId2=$pfsDesignId
fi
pfsDesignIdOdd=$3
if [ -z "$pfsDesignIdOdd" ]; then
    pfsDesignIdOdd=$pfsDesignId
fi
pfsDesignIdEven=$4
if [ -z "$pfsDesignIdEven" ]; then
    pfsDesignIdEven=$pfsDesignId
fi

makeSimExposure() {
    for detector in r1 b1; do
        makeSim --detector $detector $([ $detector = "r1" ] && echo "--pfsConfig") $(echo "$@" | sed "s|@DETECTOR@|$detector|g") &
    done
    wait
}

set -e

makeSimExposure --pfsDesignId $pfsDesignId --exptime 0 --visit 0 --visit 1 --visit 2 --visit 3 --visit 4 --visit 5 --visit 6 --visit 7 --visit 8 --visit 9 --type bias
makeSimExposure --pfsDesignId $pfsDesignId --exptime 900 --visit 10 --visit 11 --visit 12 --visit 13 --visit 14 --visit 15 --visit 16 --visit 17 --visit 18 --visit 19 --type dark
makeSimExposure --pfsDesignId $pfsDesignId --exptime 30 --visit 20 --visit 21 --visit 22 --type flat --xoffset 0 --detectorMap detectorMap-sim-@DETECTOR@.fits
makeSimExposure --pfsDesignId $pfsDesignId --exptime 30 --visit 23 --visit 24 --visit 25 --type flat --xoffset 2000
makeSimExposure --pfsDesignId $pfsDesignId --exptime 30 --visit 26 --visit 27 --visit 28 --type flat --xoffset 4000
makeSimExposure --pfsDesignId $pfsDesignId --exptime 30 --visit 29 --visit 30 --visit 31 --type flat --xoffset -2000
makeSimExposure --pfsDesignId $pfsDesignId --exptime 30 --visit 32 --visit 33 --visit 34 --type flat --xoffset -4000
makeSimExposure --pfsDesignId $pfsDesignId --exptime 1 --visit 35 --type ARC --lamps NE
makeSimExposure --pfsDesignId $pfsDesignId --exptime 900 --visit 36 --type object --allOutput
makeSimExposure --pfsDesignId $pfsDesignId2 --exptime 900 --visit 37 --type object --allOutput
makeSimExposure --pfsDesignId $pfsDesignIdOdd --exptime 30 --visit 38 --type flat --xoffset 0
makeSimExposure --pfsDesignId $pfsDesignIdEven --exptime 30 --visit 39 --type flat --xoffset 0
